<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Paper: A critique of ANSI SQL isolation levels 笔记 | bloging</title>
    <meta name="description" content="some notes about cs">
    <link rel="icon" href="/blogs/img/logo.ico">
  <link rel="manifest" href="/blogs/manifest.json">
    
    <link rel="preload" href="/blogs/assets/css/0.styles.8b9e79ee.css" as="style"><link rel="preload" href="/blogs/assets/js/app.aa15e581.js" as="script"><link rel="preload" href="/blogs/assets/js/2.b2c8d346.js" as="script"><link rel="preload" href="/blogs/assets/js/8.f7f10563.js" as="script"><link rel="prefetch" href="/blogs/assets/js/10.ba4c31f4.js"><link rel="prefetch" href="/blogs/assets/js/11.b4a8a674.js"><link rel="prefetch" href="/blogs/assets/js/12.29ad8b2d.js"><link rel="prefetch" href="/blogs/assets/js/3.5b8eab2c.js"><link rel="prefetch" href="/blogs/assets/js/4.2d02bb5f.js"><link rel="prefetch" href="/blogs/assets/js/5.638d79b0.js"><link rel="prefetch" href="/blogs/assets/js/6.f9d58ded.js"><link rel="prefetch" href="/blogs/assets/js/7.eec15176.js"><link rel="prefetch" href="/blogs/assets/js/9.9d1a03b3.js">
    <link rel="stylesheet" href="/blogs/assets/css/0.styles.8b9e79ee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><article id="post"><div class="content default"><h3 id="paper-a-critique-of-ansi-sql-isolation-levels-笔记">Paper: A critique of ANSI SQL isolation levels 笔记</h3> <h4 id="p1-dirty-read-脏读">P1(Dirty Read): 脏读</h4> <div class="language- extra-class"><pre class="language-text"><code>w1[x] ... r2[x] ...
</code></pre></div><ul><li>txn1 修改了一行数据。（未 commit 之前）</li> <li>txn2 读到修改的值。（未commit 之前）</li></ul> <h4 id="p2-fuzz-or-non-repeatable-read-不可重读">P2(Fuzz or Non-repeatable Read): 不可重读</h4> <div class="language- extra-class"><pre class="language-text"><code>r1[x] ... w2[x] ... c2 ... r1[x] ... c1
</code></pre></div><ul><li>txn1 读了一个数据，</li> <li>txn2 修改这个数据，并 commit</li> <li>txn1 重新读这个数据，读到新的值。</li></ul> <h4 id="p3-phantom-幻读">P3(Phantom): 幻读</h4> <div class="language- extra-class"><pre class="language-text"><code>r1[P] ... w2[y in P] ... c2 ... r1[P] ... c1
</code></pre></div><ul><li>txn1 读了一段满足某个 condition 的数据，</li> <li>txn2 修改了一条数据，使之满足或者不满足这个 condition（比如说删掉了一条满足 condition 的数据，新增了一条满足 condition 数据），并 commit。</li> <li>txn1 重新读满足这个 condition 的数据，返回数据变化。</li></ul> <p>P2 可以看做是 P3 的特殊 case。</p> <h4 id="p0-dirty-write-脏写">P0(Dirty Write): 脏写</h4> <div class="language- extra-class"><pre class="language-text"><code>w1[x] ... w2[x] ... ((c1 or a1) and (c2 or a2) in any order)
</code></pre></div><ul><li>txn1 修改了一条数据。</li> <li>txn2 再次修改同一条数据。</li></ul> <p>txn2 应该 abort 或者 等待 txn1 结束。否则会破坏数据约束。</p> <p>比如： <code>w1[x = 10] w2[x = 20] w2[y = 20] c2 w1[y = 10] c1</code> 会违背 x = y 这个约束。</p> <p>论文给出：</p> <table><thead><tr><th style="text-align:center;">Isolation Level</th> <th style="text-align:center;">P0: Dirty Write</th> <th style="text-align:center;">P1: Dirty Read</th> <th style="text-align:center;">P2: Fuzzy Read</th> <th style="text-align:center;">P3: Phantom</th></tr></thead> <tbody><tr><td style="text-align:center;">READ UNCOMMITTED</td> <td style="text-align:center;">Not Possible</td> <td style="text-align:center;">Possible</td> <td style="text-align:center;">Possible</td> <td style="text-align:center;">Possible</td></tr> <tr><td style="text-align:center;">READ COMMITTED</td> <td style="text-align:center;">Not Possible</td> <td style="text-align:center;">Not Possible</td> <td style="text-align:center;">Possible</td> <td style="text-align:center;">Possible</td></tr> <tr><td style="text-align:center;">REPEATABLE READ</td> <td style="text-align:center;">Not Possible</td> <td style="text-align:center;">Not Possible</td> <td style="text-align:center;">Not Possible</td> <td style="text-align:center;">Possible</td></tr> <tr><td style="text-align:center;">SERIALIZABLE</td> <td style="text-align:center;">Not Possible</td> <td style="text-align:center;">Not Possible</td> <td style="text-align:center;">Not Possible</td> <td style="text-align:center;">Not Possible</td></tr></tbody></table> <p>但是还有其他的 anomaly !!!</p> <h4 id="p4-lost-update">P4(Lost Update):</h4> <div class="language- extra-class"><pre class="language-text"><code>r1[x] ... r2[x] ... w2[x] ... w1[x] ... c1 ... c2
</code></pre></div><ul><li>txn1 读了一条数据。</li> <li>txn2 读了并修改了这条数据。</li> <li>txn1 修改这条数据，然后 commit。</li> <li>txn2 commit。</li></ul> <p>txn1 做的修改不见了。</p> <h4 id="a5a-read-skew-读偏斜">A5A(Read Skew): 读偏斜</h4> <div class="language- extra-class"><pre class="language-text"><code>r1[x]...w2[x]...w2[y]...c2...r1[y]...(c1 or a1)
</code></pre></div><ul><li>txn1 读了 x。</li> <li>txn2 写了 x 和 y，然后 commit。</li> <li>txn1 再读 y，读到新值。</li></ul> <p>txn 读到的 x，y 不满足某个约束（比如 x==y）。</p> <h4 id="a5b-write-skew-写偏斜">A5B(Write Skew): 写偏斜</h4> <div class="language- extra-class"><pre class="language-text"><code>r1[x]...r2[y]...w1[y] ...w2[x]...(c1 and c2)
</code></pre></div><ul><li>txn1 读了x。</li> <li>txn2 读了 y。</li> <li>txn1 写了 y。</li> <li>txn2 写了 x。</li> <li>两个 txn 做 commit。</li></ul> <p>最后 x，y 可能不满足某个约束。比如（x+y=2）</p></div></article><div class="global-ui"></div></div>
    <script src="/blogs/assets/js/app.aa15e581.js" defer></script><script src="/blogs/assets/js/2.b2c8d346.js" defer></script><script src="/blogs/assets/js/8.f7f10563.js" defer></script>
  </body>
</html>
